<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢ç¢¼æ¯”å°å·¥å…·</title>
    <!-- å¼•å…¥ html5-qrcode æƒç¢¼å¥—ä»¶ -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 15px;
            box-sizing: border-box;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .title {
            margin: 0;
            color: #333;
            font-size: 22px;
        }
        .lang-select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 14px;
            background: #fff;
        }
        .card {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            margin-bottom: 10px;
            background-color: #fafafa;
            /* è®“è¼¸å…¥æ¡†è¢«é¸å–æ™‚æœ‰æ˜é¡¯çš„è—æ¡† */
            outline: none;
        }
        input[type="text"]:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 5px rgba(13, 110, 253, 0.3);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-scan { background-color: #0d6efd; color: white; }
        .btn-clear { background-color: #6c757d; color: white; }
        .btn-clear-all { background-color: #dc3545; color: white; }
        .btn-compare { background-color: #198754; color: white; }
        
        /* æƒæå€å¡Š */
        #scanner-container {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #reader { width: 100%; max-width: 500px; }
        .btn-cancel-scan {
            margin-top: 20px;
            background-color: #dc3545;
            color: white;
            width: 80%;
            max-width: 300px;
        }

        /* å½ˆå‡ºè¦–çª— Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 85%;
            max-width: 400px;
            text-align: center;
            font-size: 18px;
            line-height: 1.6;
        }
        .modal-content p { margin: 10px 0; word-break: break-all; }
        .result-text { font-size: 24px; font-weight: bold; margin-top: 15px; }
        .match { color: #198754; }
        .mismatch { color: #dc3545; }
        
        .mode-selector {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 8px;
        }
        .mode-selector label { font-weight: normal; margin: 0; font-size: 15px; }
    </style>
</head>
<body>

    <div class="header">
        <h2 class="title" id="ui-title">æ¢ç¢¼æ¯”å°å·¥å…·</h2>
        <!-- èªç³»åˆ‡æ›é¸å–® -->
        <select class="lang-select" id="langSelector" onchange="changeLanguage()">
            <option value="zh-TW" selected>ç¹é«”ä¸­æ–‡</option>
            <option value="en">English</option>
            <option value="vi">Tiáº¿ng Viá»‡t</option>
        </select>
    </div>

    <!-- æ¨¡å¼é¸æ“‡ -->
    <div class="card">
        <label id="ui-mode-label">æ¯”å°æ¨¡å¼ï¼š</label>
        <div class="mode-selector">
            <label><input type="radio" name="compareMode" value="auto" checked> <span id="ui-mode-auto">è‡ªå‹•æ¯”å°</span></label>
            <label><input type="radio" name="compareMode" value="manual"> <span id="ui-mode-manual">æ‰‹å‹•é»é¸</span></label>
        </div>
    </div>

    <!-- æ¬„ä½ A -->
    <div class="card">
        <label id="ui-field-a-label">A æ¬„ä½</label>
        <!-- ã€ä¿®æ”¹é‡é»ã€‘ç§»é™¤ onclick èˆ‡ readonlyï¼ŒåŠ å…¥ oninput -->
        <input type="text" id="fieldA" placeholder="è«‹æ‰‹å‹•è¼¸å…¥æˆ–é»é¸æƒæ" oninput="checkAutoCompare()">
        <div class="button-group">
            <button class="btn-scan" id="ui-btn-scan-a" onclick="startScan('A')">ğŸ“· æƒæ A</button>
            <button class="btn-clear" id="ui-btn-clear-a" onclick="clearField('A')">æ¸…é™¤ A</button>
        </div>
    </div>

    <!-- æ¬„ä½ B -->
    <div class="card">
        <label id="ui-field-b-label">B æ¬„ä½</label>
        <!-- ã€ä¿®æ”¹é‡é»ã€‘ç§»é™¤ onclick èˆ‡ readonlyï¼ŒåŠ å…¥ oninput -->
        <input type="text" id="fieldB" placeholder="è«‹æ‰‹å‹•è¼¸å…¥æˆ–é»é¸æƒæ" oninput="checkAutoCompare()">
        <div class="button-group">
            <button class="btn-scan" id="ui-btn-scan-b" onclick="startScan('B')">ğŸ“· æƒæ B</button>
            <button class="btn-clear" id="ui-btn-clear-b" onclick="clearField('B')">æ¸…é™¤ B</button>
        </div>
    </div>

    <!-- å…¨åŸŸæ“ä½œ -->
    <div class="card">
        <div class="button-group">
            <button class="btn-clear-all" id="ui-btn-clear-all" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</button>
            <button class="btn-compare" id="ui-btn-compare" onclick="manualCompare()">ğŸ” åŸ·è¡Œæ¯”å°</button>
        </div>
    </div>

    <!-- æƒæç›¸æ©Ÿä»‹é¢ -->
    <div id="scanner-container">
        <div id="reader"></div>
        <button class="btn-cancel-scan" id="ui-btn-cancel-scan" onclick="stopScan()">å–æ¶ˆæƒæ</button>
    </div>

    <!-- æ¯”å°çµæœå½ˆå‡ºè¦–çª— -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <p><strong id="ui-modal-row1">ç¬¬ä¸€åˆ— (Aæ¬„ä½)</strong><br><span id="modalValA"></span></p>
            <p><strong id="ui-modal-row2">ç¬¬äºŒåˆ— (Bæ¬„ä½)</strong><br><span id="modalValB"></span></p>
            <hr>
            <p id="modalResult" class="result-text"></p>
            <button class="btn-clear" id="ui-modal-close" style="width: 100%; margin-top: 15px;" onclick="closeModal()">é—œé–‰</button>
        </div>
    </div>

    <script>
        let html5QrCode;
        let currentTarget = null;
        let currentLang = 'zh-TW';

        // ================= èªç³»å­—å…¸ (i18n) =================
        const translations = {
            'zh-TW': {
                title: 'æ¢ç¢¼æ¯”å°å·¥å…·',
                modeLabel: 'æ¯”å°æ¨¡å¼ï¼š',
                modeAuto: 'è‡ªå‹•æ¯”å°',
                modeManual: 'æ‰‹å‹•é»é¸',
                fieldALabel: 'A æ¬„ä½',
                fieldBLabel: 'B æ¬„ä½',
                placeholder: 'è«‹æ‰‹å‹•è¼¸å…¥æˆ–é»æ“Šä¸‹æ–¹æƒæ', // ä¿®æ”¹äº†æç¤ºæ–‡å­—
                btnScanA: 'ğŸ“· æƒæ A',
                btnScanB: 'ğŸ“· æƒæ B',
                btnClearA: 'æ¸…é™¤ A',
                btnClearB: 'æ¸…é™¤ B',
                btnClearAll: 'ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨',
                btnCompare: 'ğŸ” åŸ·è¡Œæ¯”å°',
                btnCancelScan: 'å–æ¶ˆæƒæ',
                modalRow1: 'ç¬¬ä¸€åˆ— (Aæ¬„ä½)',
                modalRow2: 'ç¬¬äºŒåˆ— (Bæ¬„ä½)',
                modalClose: 'é—œé–‰',
                matchSuccess: 'âœ… æ¯”å°æˆåŠŸ (ç›¸ç¬¦)',
                matchFail: 'âŒ æ¯”å°å¤±æ•— (ä¸ç›¸ç¬¦)',
                alertEmpty: 'è«‹ç¢ºèª A æ¬„ä½èˆ‡ B æ¬„ä½çš†å·²å–å¾—æ¢ç¢¼å…§å®¹ï¼',
                alertCamFail: 'å•Ÿå‹•ç›¸æ©Ÿå¤±æ•—ï¼Œè«‹ç¢ºèªæ¬Šé™ï¼š'
            },
            'en': {
                title: 'Barcode Matcher',
                modeLabel: 'Mode:',
                modeAuto: 'Auto Match',
                modeManual: 'Manual',
                fieldALabel: 'Field A',
                fieldBLabel: 'Field B',
                placeholder: 'Type manually or tap scan below', // ä¿®æ”¹äº†æç¤ºæ–‡å­—
                btnScanA: 'ğŸ“· Scan A',
                btnScanB: 'ğŸ“· Scan B',
                btnClearA: 'Clear A',
                btnClearB: 'Clear B',
                btnClearAll: 'ğŸ—‘ï¸ Clear All',
                btnCompare: 'ğŸ” Compare',
                btnCancelScan: 'Cancel Scan',
                modalRow1: 'Row 1 (Field A)',
                modalRow2: 'Row 2 (Field B)',
                modalClose: 'Close',
                matchSuccess: 'âœ… Match (Success)',
                matchFail: 'âŒ Mismatch (Fail)',
                alertEmpty: 'Please ensure both fields have barcode data!',
                alertCamFail: 'Camera failed. Check permissions: '
            },
            'vi': {
                title: 'CÃ´ng cá»¥ so sÃ¡nh mÃ£ váº¡ch',
                modeLabel: 'Cháº¿ Ä‘á»™:',
                modeAuto: 'Tá»± Ä‘á»™ng',
                modeManual: 'Thá»§ cÃ´ng',
                fieldALabel: 'TrÆ°á»ng A',
                fieldBLabel: 'TrÆ°á»ng B',
                placeholder: 'Nháº­p thá»§ cÃ´ng hoáº·c nháº¥n quÃ©t', // ä¿®æ”¹äº†æç¤ºæ–‡å­—
                btnScanA: 'ğŸ“· QuÃ©t A',
                btnScanB: 'ğŸ“· QuÃ©t B',
                btnClearA: 'XÃ³a A',
                btnClearB: 'XÃ³a B',
                btnClearAll: 'ğŸ—‘ï¸ XÃ³a táº¥t cáº£',
                btnCompare: 'ğŸ” So sÃ¡nh',
                btnCancelScan: 'Há»§y quÃ©t',
                modalRow1: 'HÃ ng 1 (TrÆ°á»ng A)',
                modalRow2: 'HÃ ng 2 (TrÆ°á»ng B)',
                modalClose: 'ÄÃ³ng',
                matchSuccess: 'âœ… Khá»›p (ThÃ nh cÃ´ng)',
                matchFail: 'âŒ KhÃ´ng khá»›p (Tháº¥t báº¡i)',
                alertEmpty: 'Vui lÃ²ng Ä‘áº£m báº£o cáº£ hai trÆ°á»ng Ä‘á»u cÃ³ dá»¯ liá»‡u!',
                alertCamFail: 'Lá»—i mÃ¡y áº£nh. Kiá»ƒm tra quyá»n: '
            }
        };

        // åˆ‡æ›èªç³»åŠŸèƒ½
        function changeLanguage() {
            currentLang = document.getElementById('langSelector').value;
            const t = translations[currentLang];

            document.getElementById('ui-title').innerText = t.title;
            document.getElementById('ui-mode-label').innerText = t.modeLabel;
            document.getElementById('ui-mode-auto').innerText = t.modeAuto;
            document.getElementById('ui-mode-manual').innerText = t.modeManual;
            document.getElementById('ui-field-a-label').innerText = t.fieldALabel;
            document.getElementById('ui-field-b-label').innerText = t.fieldBLabel;
            
            document.getElementById('fieldA').placeholder = t.placeholder;
            document.getElementById('fieldB').placeholder = t.placeholder;

            document.getElementById('ui-btn-scan-a').innerText = t.btnScanA;
            document.getElementById('ui-btn-scan-b').innerText = t.btnScanB;
            document.getElementById('ui-btn-clear-a').innerText = t.btnClearA;
            document.getElementById('ui-btn-clear-b').innerText = t.btnClearB;
            document.getElementById('ui-btn-clear-all').innerText = t.btnClearAll;
            document.getElementById('ui-btn-compare').innerText = t.btnCompare;
            document.getElementById('ui-btn-cancel-scan').innerText = t.btnCancelScan;
            
            document.getElementById('ui-modal-row1').innerText = t.modalRow1;
            document.getElementById('ui-modal-row2').innerText = t.modalRow2;
            document.getElementById('ui-modal-close').innerText = t.modalClose;
        }

        // ================= æ ¸å¿ƒé‚è¼¯ =================

        // å–å‡ºæ¢ç¢¼ä¸­ç‰¹å®šå€æ®µçš„æ–‡å­—
        function extractSpecificText(rawText) {
            // é è¨­ï¼šä¸æ“·å–ï¼Œç›´æ¥å›å‚³æƒæåˆ°çš„å®Œæ•´æ–‡å­—
            return rawText; 
        }

        // å•Ÿå‹•ç›¸æ©Ÿæƒæ (å·²ä¿®å¾©æ¬Šé™èˆ‡è¨­å®šéŒ¯èª¤)
        function startScan(target) {
            currentTarget = target;
            document.getElementById('scanner-container').style.display = 'flex';

            if (!html5QrCode) {
                html5QrCode = new Html5Qrcode("reader");
            }
            
            // åŸºæœ¬ç›¸æ©ŸæŒ‡å®š (è§£æ±º 1 key å ±éŒ¯)
            const cameraConfig = { facingMode: "environment" };

            // æƒæå™¨èˆ‡é€²éšå½±åƒè¨­å®š
            const scanConfig = { 
                fps: 15,
                // å°‡é«˜è§£æåº¦èˆ‡å°ç„¦ç­‰é€²éšè¨­å®šï¼ŒåŒ…åœ¨ videoConstraints è£¡é¢
                videoConstraints: {
                    facingMode: "environment",
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    advanced: [{ focusMode: "continuous" }]
                }
            };

            // å•Ÿå‹•ç›¸æ©Ÿ
            html5QrCode.start(cameraConfig, scanConfig, onScanSuccess)
            .catch(err => {
                alert(translations[currentLang].alertCamFail + "\n" + err);
                stopScan();
            });
        }

        // åœæ­¢æƒæ
        function stopScan() {
            document.getElementById('scanner-container').style.display = 'none';
            if (html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop().then(ignore => {}).catch(err => {});
            }
        }

        // æƒææˆåŠŸçš„å›èª¿å‡½æ•¸
        function onScanSuccess(decodedText, decodedResult) {
            if (navigator.vibrate) navigator.vibrate(200);
            stopScan();
            
            const extractedText = extractSpecificText(decodedText);
            
            if (currentTarget === 'A') {
                document.getElementById('fieldA').value = extractedText;
            } else if (currentTarget === 'B') {
                document.getElementById('fieldB').value = extractedText;
            }
            
            checkAutoCompare();
        }

        function clearField(target) {
            if (target === 'A') document.getElementById('fieldA').value = '';
            if (target === 'B') document.getElementById('fieldB').value = '';
        }

        function clearAll() {
            clearField('A');
            clearField('B');
        }

        function checkAutoCompare() {
            const mode = document.querySelector('input[name="compareMode"]:checked').value;
            const valA = document.getElementById('fieldA').value;
            const valB = document.getElementById('fieldB').value;

            // ç•¶æ¨¡å¼ç‚ºè‡ªå‹•ï¼Œä¸”Aèˆ‡Béƒ½æœ‰å…§å®¹æ™‚ï¼Œæ‰åŸ·è¡Œæ¯”å°
            if (mode === 'auto' && valA !== '' && valB !== '') {
                showCompareResult(valA, valB);
            }
        }

        function manualCompare() {
            const valA = document.getElementById('fieldA').value;
            const valB = document.getElementById('fieldB').value;

            if (valA === '' || valB === '') {
                alert(translations[currentLang].alertEmpty);
                return;
            }
            showCompareResult(valA, valB);
        }

        function showCompareResult(valA, valB) {
            const isMatch = (valA === valB);
            const t = translations[currentLang];
            
            document.getElementById('modalValA').innerText = valA;
            document.getElementById('modalValB').innerText = valB;
            
            const resultElement = document.getElementById('modalResult');
            if (isMatch) {
                resultElement.innerText = t.matchSuccess;
                resultElement.className = "result-text match";
            } else {
                resultElement.innerText = t.matchFail;
                resultElement.className = "result-text mismatch";
            }

            document.getElementById('resultModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–èªç³»
        window.onload = () => {
            changeLanguage();
        };
    </script>
</body>
</html>
