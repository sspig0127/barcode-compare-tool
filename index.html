<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ¢ç¢¼æ¯”å°å·¥å…·</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      margin: 0; padding: 15px; box-sizing: border-box;
    }
    .header {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 15px;
    }
    .title { margin: 0; color: #333; font-size: 22px; }
    .lang-select {
      padding: 5px 10px; border-radius: 5px;
      border: 1px solid #ccc; font-size: 14px; background: #fff;
    }
    .card {
      background: #fff; padding: 15px; border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px;
    }
    label { font-weight: bold; display: block; margin-bottom: 5px; }
    input[type="text"] {
      width: 100%; padding: 12px; font-size: 16px;
      border: 1px solid #ccc; border-radius: 6px;
      box-sizing: border-box; margin-bottom: 10px;
      background-color: #fafafa; outline: none;
    }
    input[type="text"]:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 5px rgba(13, 110, 253, 0.3);
    }
    .button-group { display: flex; gap: 10px; margin-bottom: 10px; }
    button {
      flex: 1; padding: 12px; font-size: 16px;
      border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
    }
    .btn-scan      { background-color: #0d6efd; color: white; }
    .btn-clear     { background-color: #6c757d; color: white; }
    .btn-clear-all { background-color: #dc3545; color: white; }
    .btn-compare   { background-color: #198754; color: white; }

    /* â”€â”€ æƒæå™¨è¦†è“‹å±¤ â”€â”€ */
    #scanner-container {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 1000;
      flex-direction: column;
      align-items: center;
      /* justify-content: center â† å·²ç§»é™¤ */
      padding: 8px 10px;
      padding-top:    calc(8px + env(safe-area-inset-top,    0px));
      padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px));
      box-sizing: border-box;
    }

    /* ç›¸æ©Ÿé è¦½å¡«æ»¿ä¸­é–“ç©ºé–“ */
    #reader {
      width: 100%;
      max-width: 500px;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    /* é¡é ­é¸å–® */
    .camera-selector-wrap {
      flex-shrink: 0;
      width: 100%;
      max-width: 500px;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }
    .camera-selector-wrap label {
      color: #fff; font-size: 14px;
      white-space: nowrap; margin: 0; font-weight: normal;
    }
    #cameraSelect {
      flex: 1; padding: 8px 10px; font-size: 14px;
      border-radius: 6px; border: 1px solid rgba(255,255,255,0.4);
      background: rgba(255,255,255,0.15); color: #fff;
    }
    #cameraSelect option   { color: #333; background: #fff; }
    #cameraSelect:disabled { opacity: 0.6; }

    /* â˜… 1D / 2D åˆ‡æ›æŒ‰éˆ•åˆ— */
    .scan-mode-wrap {
      flex-shrink: 0;
      width: 100%;
      max-width: 500px;
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    .btn-mode {
      flex: 1;
      padding: 7px 10px;
      font-size: 13px;
      font-weight: bold;
      border-radius: 20px;              /* pill é€ å‹ */
      border: 2px solid rgba(255,255,255,0.45);
      background: transparent;
      color: rgba(255,255,255,0.55);
      cursor: pointer;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
    }
    .btn-mode.active {
      background: #ffffff;
      color: #1a1a1a;
      border-color: #ffffff;
    }

    /* å–æ¶ˆæŒ‰éˆ• */
    .btn-cancel-scan {
      flex-shrink: 0;
      margin-top: 8px;
      margin-bottom: 4px;
      background-color: #dc3545;
      color: white;
      width: auto;
      padding: 8px 28px;
      font-size: 14px;
    }

    /* â”€â”€ çµæœ Modal â”€â”€ */
    .modal {
      display: none; position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5); z-index: 2000;
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 10px;
      width: 85%; max-width: 400px;
      text-align: center; font-size: 18px; line-height: 1.6;
    }
    .modal-content p { margin: 10px 0; word-break: break-all; }
    .result-text { font-size: 24px; font-weight: bold; margin-top: 15px; }
    .match    { color: #198754; }
    .mismatch { color: #dc3545; }

    /* â”€â”€ æ¯”å°æ¨¡å¼ â”€â”€ */
    .mode-selector {
      display: flex; justify-content: space-around;
      margin-bottom: 15px; padding: 10px;
      background: #e9ecef; border-radius: 8px;
    }
    .mode-selector label { font-weight: normal; margin: 0; font-size: 15px; }
  </style>
</head>
<body>

  <!-- é é¦–ï¼šæ¨™é¡Œ + èªè¨€é¸æ“‡ -->
  <div class="header">
    <h2 class="title" id="ui-title">æ¢ç¢¼æ¯”å°å·¥å…·</h2>
    <select class="lang-select" id="langSelector" onchange="changeLanguage()">
      <option value="zh-TW" selected>ç¹é«”ä¸­æ–‡</option>
      <option value="en">English</option>
      <option value="vi">Tiáº¿ng Viá»‡t</option>
    </select>
  </div>

  <!-- æ¯”å°æ¨¡å¼ -->
  <div class="card">
    <label id="ui-mode-label">æ¯”å°æ¨¡å¼ï¼š</label>
    <div class="mode-selector">
      <label>
        <input type="radio" name="compareMode" value="auto" checked>
        <span id="ui-mode-auto">è‡ªå‹•æ¯”å°</span>
      </label>
      <label>
        <input type="radio" name="compareMode" value="manual">
        <span id="ui-mode-manual">æ‰‹å‹•é»é¸</span>
      </label>
    </div>
  </div>

  <!-- A æ¬„ä½ -->
  <div class="card">
    <label id="ui-field-a-label">A æ¬„ä½</label>
    <input type="text" id="fieldA" placeholder="" oninput="checkAutoCompare()">
    <div class="button-group">
      <button class="btn-scan"  id="ui-btn-scan-a"  onclick="startScan('A')">ğŸ“· æƒæ A</button>
      <button class="btn-clear" id="ui-btn-clear-a" onclick="clearField('A')">æ¸…é™¤ A</button>
    </div>
  </div>

  <!-- B æ¬„ä½ -->
  <div class="card">
    <label id="ui-field-b-label">B æ¬„ä½</label>
    <input type="text" id="fieldB" placeholder="" oninput="checkAutoCompare()">
    <div class="button-group">
      <button class="btn-scan"  id="ui-btn-scan-b"  onclick="startScan('B')">ğŸ“· æƒæ B</button>
      <button class="btn-clear" id="ui-btn-clear-b" onclick="clearField('B')">æ¸…é™¤ B</button>
    </div>
  </div>

  <!-- æ“ä½œæŒ‰éˆ•åˆ— -->
  <div class="card">
    <div class="button-group">
      <button class="btn-clear-all" id="ui-btn-clear-all" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</button>
      <button class="btn-compare"   id="ui-btn-compare"   onclick="manualCompare()">ğŸ” åŸ·è¡Œæ¯”å°</button>
    </div>
  </div>

  <!-- æƒæå™¨è¦†è“‹å±¤ -->
  <div id="scanner-container">

    <!-- é¡é ­é¸æ“‡ -->
    <div class="camera-selector-wrap">
      <label id="ui-camera-label">åˆ‡æ›é¡é ­ï¼š</label>
      <select id="cameraSelect" onchange="switchCamera(this.value)" disabled>
        <option id="ui-camera-loading-opt">è¼‰å…¥é¡é ­æ¸…å–®...</option>
      </select>
    </div>

    <!-- â˜… 1D / 2D åˆ‡æ› -->
    <div class="scan-mode-wrap">
      <button class="btn-mode" id="btn-mode-1d" onclick="setScanMode('1D')">
        ğŸ“Š <span id="ui-btn-mode-1d">1D æ¢ç¢¼</span>
      </button>
      <button class="btn-mode active" id="btn-mode-2d" onclick="setScanMode('2D')">
        â–¦ <span id="ui-btn-mode-2d">2D / QR Code</span>
      </button>
    </div>

    <div id="reader"></div>
    <button class="btn-cancel-scan" id="ui-btn-cancel-scan" onclick="stopScan()">å–æ¶ˆæƒæ</button>
  </div>

  <!-- æ¯”å°çµæœ Modal -->
  <div id="resultModal" class="modal">
    <div class="modal-content">
      <p><strong id="ui-modal-row1">ç¬¬ä¸€åˆ— (Aæ¬„ä½)</strong><br><span id="modalValA"></span></p>
      <p><strong id="ui-modal-row2">ç¬¬äºŒåˆ— (Bæ¬„ä½)</strong><br><span id="modalValB"></span></p>
      <hr>
      <p id="modalResult" class="result-text"></p>
      <button class="btn-clear" id="ui-modal-close"
              style="width:100%;margin-top:15px" onclick="closeModal()">é—œé–‰</button>
    </div>
  </div>

  <script>
    let html5QrCode    = null;
    let currentTarget  = null;
    let currentLang    = 'zh-TW';
    let cameras        = [];
    let scanMode       = '2D';   // â˜… '1D' | '2D'ï¼Œé è¨­ 2D
    let currentCameraId = null;  // â˜… è¨˜éŒ„ç›®å‰ä½¿ç”¨çš„é¡é ­ ID

    // â”€â”€ i18n ç¿»è­¯è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const translations = {
      'zh-TW': {
        title         : 'æ¢ç¢¼æ¯”å°å·¥å…·',
        modeLabel     : 'æ¯”å°æ¨¡å¼ï¼š',
        modeAuto      : 'è‡ªå‹•æ¯”å°',
        modeManual    : 'æ‰‹å‹•é»é¸',
        fieldALabel   : 'A æ¬„ä½',
        fieldBLabel   : 'B æ¬„ä½',
        placeholder   : 'æ‰‹å‹•è¼¸å…¥æˆ–é»ä¸‹æ–¹æƒæ',
        btnScanA      : 'ğŸ“· æƒæ A',
        btnScanB      : 'ğŸ“· æƒæ B',
        btnClearA     : 'æ¸…é™¤ A',
        btnClearB     : 'æ¸…é™¤ B',
        btnClearAll   : 'ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨',
        btnCompare    : 'ğŸ” åŸ·è¡Œæ¯”å°',
        btnCancelScan : 'å–æ¶ˆæƒæ',
        modalRow1     : 'ç¬¬ä¸€åˆ— (Aæ¬„ä½)',
        modalRow2     : 'ç¬¬äºŒåˆ— (Bæ¬„ä½)',
        modalClose    : 'é—œé–‰',
        matchSuccess  : 'âœ… æ¯”å°æˆåŠŸ',
        matchFail     : 'âŒ æ¯”å°å¤±æ•—',
        alertEmpty    : 'è«‹ç¢ºä¿ Aã€B å…©æ¬„ä½éƒ½æœ‰æ¢ç¢¼è³‡æ–™ï¼',
        alertCamFail  : 'é¡é ­å•Ÿå‹•å¤±æ•—ï¼Œè«‹ç¢ºèªç›¸æ©Ÿæ¬Šé™ã€‚',
        cameraLabel   : 'åˆ‡æ›é¡é ­ï¼š',
        cameraLoading : 'è¼‰å…¥é¡é ­æ¸…å–®...',
        cameraDefault : 'é¡é ­',
        alertCamSwitch: 'åˆ‡æ›é¡é ­å¤±æ•—ï¼š',
        btnMode1D     : '1D æ¢ç¢¼',       // â˜…
        btnMode2D     : '2D / QR Code',  // â˜…
      },
      'en': {
        title         : 'Barcode Matcher',
        modeLabel     : 'Mode:',
        modeAuto      : 'Auto Match',
        modeManual    : 'Manual',
        fieldALabel   : 'Field A',
        fieldBLabel   : 'Field B',
        placeholder   : 'Type manually or tap scan below',
        btnScanA      : 'ğŸ“· Scan A',
        btnScanB      : 'ğŸ“· Scan B',
        btnClearA     : 'Clear A',
        btnClearB     : 'Clear B',
        btnClearAll   : 'ğŸ—‘ï¸ Clear All',
        btnCompare    : 'ğŸ” Compare',
        btnCancelScan : 'Cancel Scan',
        modalRow1     : 'Row 1 (Field A)',
        modalRow2     : 'Row 2 (Field B)',
        modalClose    : 'Close',
        matchSuccess  : 'âœ… Match â€” Success',
        matchFail     : 'âŒ Mismatch â€” Fail',
        alertEmpty    : 'Please ensure both fields have barcode data!',
        alertCamFail  : 'Camera failed. Check permissions.',
        cameraLabel   : 'Switch Camera:',
        cameraLoading : 'Loading cameras...',
        cameraDefault : 'Camera',
        alertCamSwitch: 'Camera switch failed: ',
        btnMode1D     : '1D Barcode',    // â˜…
        btnMode2D     : '2D / QR Code',  // â˜…
      },
      'vi': {
        title         : 'CÃ´ng cá»¥ so sÃ¡nh mÃ£ váº¡ch',
        modeLabel     : 'Cháº¿ Ä‘á»™:',
        modeAuto      : 'Tá»± Ä‘á»™ng',
        modeManual    : 'Thá»§ cÃ´ng',
        fieldALabel   : 'TrÆ°á»ng A',
        fieldBLabel   : 'TrÆ°á»ng B',
        placeholder   : 'Nháº­p thá»§ cÃ´ng hoáº·c nháº¥n quÃ©t',
        btnScanA      : 'ğŸ“· QuÃ©t A',
        btnScanB      : 'ğŸ“· QuÃ©t B',
        btnClearA     : 'XÃ³a A',
        btnClearB     : 'XÃ³a B',
        btnClearAll   : 'ğŸ—‘ï¸ XÃ³a táº¥t cáº£',
        btnCompare    : 'ğŸ” So sÃ¡nh',
        btnCancelScan : 'Há»§y quÃ©t',
        modalRow1     : 'HÃ ng 1 (TrÆ°á»ng A)',
        modalRow2     : 'HÃ ng 2 (TrÆ°á»ng B)',
        modalClose    : 'ÄÃ³ng',
        matchSuccess  : 'âœ… Khá»›p â€” ThÃ nh cÃ´ng',
        matchFail     : 'âŒ KhÃ´ng khá»›p â€” Tháº¥t báº¡i',
        alertEmpty    : 'Vui lÃ²ng Ä‘áº£m báº£o cáº£ hai trÆ°á»ng Ä‘á»u cÃ³ dá»¯ liá»‡u!',
        alertCamFail  : 'Lá»—i mÃ¡y áº£nh. Kiá»ƒm tra quyá»n.',
        cameraLabel   : 'Chuyá»ƒn camera:',
        cameraLoading : 'Äang táº£i camera...',
        cameraDefault : 'Camera',
        alertCamSwitch: 'Chuyá»ƒn camera tháº¥t báº¡i: ',
        btnMode1D     : '1D MÃ£ váº¡ch',   // â˜…
        btnMode2D     : '2D / QR Code', // â˜…
      }
    };

    // â”€â”€ èªè¨€åˆ‡æ› â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function changeLanguage() {
      currentLang = document.getElementById('langSelector').value;
      const t = translations[currentLang];
      document.getElementById('ui-title').innerText           = t.title;
      document.getElementById('ui-mode-label').innerText      = t.modeLabel;
      document.getElementById('ui-mode-auto').innerText       = t.modeAuto;
      document.getElementById('ui-mode-manual').innerText     = t.modeManual;
      document.getElementById('ui-field-a-label').innerText   = t.fieldALabel;
      document.getElementById('ui-field-b-label').innerText   = t.fieldBLabel;
      document.getElementById('fieldA').placeholder           = t.placeholder;
      document.getElementById('fieldB').placeholder           = t.placeholder;
      document.getElementById('ui-btn-scan-a').innerText      = t.btnScanA;
      document.getElementById('ui-btn-scan-b').innerText      = t.btnScanB;
      document.getElementById('ui-btn-clear-a').innerText     = t.btnClearA;
      document.getElementById('ui-btn-clear-b').innerText     = t.btnClearB;
      document.getElementById('ui-btn-clear-all').innerText   = t.btnClearAll;
      document.getElementById('ui-btn-compare').innerText     = t.btnCompare;
      document.getElementById('ui-btn-cancel-scan').innerText = t.btnCancelScan;
      document.getElementById('ui-modal-row1').innerText      = t.modalRow1;
      document.getElementById('ui-modal-row2').innerText      = t.modalRow2;
      document.getElementById('ui-modal-close').innerText     = t.modalClose;
      document.getElementById('ui-camera-label').innerText    = t.cameraLabel;
      document.getElementById('ui-btn-mode-1d').innerText     = t.btnMode1D; // â˜…
      document.getElementById('ui-btn-mode-2d').innerText     = t.btnMode2D; // â˜…
    }

    // â”€â”€ æ¢ç¢¼å­—ä¸²èƒå–ï¼ˆå¯ä¾éœ€æ±‚è‡ªè¡Œä¿®æ”¹ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function extractSpecificText(rawText) {
      return rawText;
    }

    // â˜… qrbox è¨ˆç®—ï¼šä¾ scanMode å›å‚³å°æ‡‰æƒææ¡†å°ºå¯¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function calcQrbox(viewW, viewH) {
      if (scanMode === '1D') {
        // å¯¬æ‰é•·æ¢ï¼šæ¨¡æ“¬ 1D æƒæç·šå€åŸŸ
        return {
          width:  Math.floor(viewW * 0.85),
          height: Math.floor(viewH * 0.20)
        };
      } else {
        // æ­£æ–¹å½¢ï¼šé©åˆ QR Code / 2D
        const side = Math.floor(Math.min(viewW, viewH) * 0.72);
        return { width: side, height: side };
      }
    }

    // â”€â”€ ä»¥æŒ‡å®šé¡é ­ ID å•Ÿå‹•æƒæ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function startScanWithCamera(cameraId) {
      if (html5QrCode && html5QrCode.isScanning) {
        await html5QrCode.stop();
      }
      currentCameraId = cameraId; // â˜… è¨˜éŒ„ç›®å‰é¡é ­
      const config = {
        fps: 15,
        useBarCodeDetectorIfSupported: true,
        qrbox: calcQrbox,           // â˜… å‚³å…¥å‡½å¼ï¼Œæ¯æ¬¡å•Ÿå‹•è‡ªå‹•è¨ˆç®—
        videoConstraints: {
          deviceId: { exact: cameraId },
          width:  { ideal: 1280 },
          height: { ideal: 720  },
          advanced: [{ focusMode: 'continuous' }, { torch: true }]
        }
      };
      await html5QrCode.start(
        { deviceId: { exact: cameraId } },
        config,
        onScanSuccess
      );
    }

    // â˜… åˆ‡æ› 1D / 2D æƒææ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function setScanMode(mode) {
      if (scanMode === mode) return;  // å·²æ˜¯è©²æ¨¡å¼ï¼Œä¸é‡å•Ÿ
      scanMode = mode;

      // æ›´æ–°æŒ‰éˆ•æ¨£å¼
      document.getElementById('btn-mode-1d').classList.toggle('active', mode === '1D');
      document.getElementById('btn-mode-2d').classList.toggle('active', mode === '2D');

      // è‹¥ç›¸æ©Ÿæ­£åœ¨é‹è¡Œï¼Œé‡å•Ÿä»¥å¥—ç”¨æ–°çš„ qrbox
      if (currentCameraId && html5QrCode && html5QrCode.isScanning) {
        const select = document.getElementById('cameraSelect');
        select.disabled = true;
        try {
          await startScanWithCamera(currentCameraId);
        } catch (err) {
          alert(translations[currentLang].alertCamFail + '\n' + err);
          stopScan();
        } finally {
          select.disabled = false;
        }
      }
    }

    // â”€â”€ ä½¿ç”¨è€…åˆ‡æ›é¡é ­ä¸‹æ‹‰é¸å–® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function switchCamera(cameraId) {
      if (!cameraId) return;
      const select = document.getElementById('cameraSelect');
      select.disabled = true;
      try {
        await startScanWithCamera(cameraId);
      } catch (err) {
        alert(translations[currentLang].alertCamSwitch + '\n' + err);
      } finally {
        select.disabled = false;
      }
    }

    // â”€â”€ æƒæå…¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function startScan(target) {
      currentTarget = target;
      document.getElementById('scanner-container').style.display = 'flex';
      if (!html5QrCode) html5QrCode = new Html5Qrcode('reader');

      const t      = translations[currentLang];
      const select = document.getElementById('cameraSelect');
      select.innerHTML = `<option>${t.cameraLoading}</option>`;
      select.disabled  = true;

      try {
        cameras = await Html5Qrcode.getCameras();
      } catch (err) {
        cameras = [];
      }

      if (cameras.length > 0) {
        select.innerHTML = '';
        cameras.forEach((cam, idx) => {
          const opt = document.createElement('option');
          opt.value = cam.id;
          opt.text  = cam.label || `${t.cameraDefault} ${idx + 1}`;
          select.appendChild(opt);
        });
        select.disabled = false;

        const backCam    = cameras.find(c => /back|rear|environment|å¾Œ/i.test(c.label));
        const defaultCam = backCam || cameras[cameras.length - 1];
        select.value = defaultCam.id;

        try {
          await startScanWithCamera(defaultCam.id);
        } catch (err) {
          alert(t.alertCamFail + '\n' + err);
          stopScan();
        }
      } else {
        // fallbackï¼šgetCameras() å¤±æ•—
        select.innerHTML = `<option value="">${t.cameraDefault} (é è¨­)</option>`;
        try {
          await html5QrCode.start(
            { facingMode: 'environment' },
            { fps: 15, useBarCodeDetectorIfSupported: true, qrbox: calcQrbox },
            onScanSuccess
          );
        } catch (err) {
          alert(t.alertCamFail + '\n' + err);
          stopScan();
        }
      }
    }

    // â”€â”€ åœæ­¢æƒæ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function stopScan() {
      document.getElementById('scanner-container').style.display = 'none';
      if (html5QrCode && html5QrCode.isScanning) {
        html5QrCode.stop().catch(err => console.warn('stopScan:', err));
      }
    }

    // â”€â”€ æƒææˆåŠŸå›å‘¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function onScanSuccess(decodedText) {
      if (navigator.vibrate) navigator.vibrate(200);
      stopScan();
      const extracted = extractSpecificText(decodedText);
      if (currentTarget === 'A') {
        document.getElementById('fieldA').value = extracted;
      } else if (currentTarget === 'B') {
        document.getElementById('fieldB').value = extracted;
      }
      checkAutoCompare();
    }

    // â”€â”€ æ¬„ä½æ¸…é™¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function clearField(target) {
      if (target === 'A') document.getElementById('fieldA').value = '';
      if (target === 'B') document.getElementById('fieldB').value = '';
    }
    function clearAll() { clearField('A'); clearField('B'); }

    // â”€â”€ è‡ªå‹•æ¯”å° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function checkAutoCompare() {
      const mode = document.querySelector('input[name="compareMode"]:checked').value;
      const valA = document.getElementById('fieldA').value;
      const valB = document.getElementById('fieldB').value;
      if (mode === 'auto' && valA !== '' && valB !== '') {
        showCompareResult(valA, valB);
      }
    }

    // â”€â”€ æ‰‹å‹•æ¯”å° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function manualCompare() {
      const valA = document.getElementById('fieldA').value;
      const valB = document.getElementById('fieldB').value;
      if (!valA || !valB) {
        alert(translations[currentLang].alertEmpty);
        return;
      }
      showCompareResult(valA, valB);
    }

    // â”€â”€ é¡¯ç¤ºæ¯”å°çµæœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showCompareResult(valA, valB) {
      const isMatch = (valA === valB);
      const t = translations[currentLang];
      document.getElementById('modalValA').innerText = valA;
      document.getElementById('modalValB').innerText = valB;
      const el = document.getElementById('modalResult');
      el.innerText  = isMatch ? t.matchSuccess : t.matchFail;
      el.className  = 'result-text ' + (isMatch ? 'match' : 'mismatch');
      document.getElementById('resultModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('resultModal').style.display = 'none';
    }

    window.onload = changeLanguage;
  </script>
</body>
</html>
